{# File: templates/_includes/layouts/post.njk #}
{% extends "base.njk" %} {# CORRECTED: Path to base layout #}

{# This block will inject content into the 'head_extra' block in base.njk #}
{% block head_extra %}
    {# Open Graph / Facebook Meta Tags #}
    <meta property="og:title" content="{{ title or metadata.title }}">
    <meta property="og:description" content="{{ description or metadata.description }}">
    <meta property="og:type" content="article">
    {# Construct the full URL to the post using the |url filter for the path #}
    <meta property="og:url" content="{{ metadata.url }}{{ page.url | url }}">
    {% set og_image_slug = title | slugify %}
    {# Construct the full URL to the OG Image using the |url filter for the path #}
    <meta property="og:image" content="{{ metadata.url }}{{ ('/og/' + og_image_slug + '.png') | url }}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="{{ metadata.title }}">
    {% if date %}<meta property="article:published_time" content="{{ date | htmlDateString }}">{% endif %}
    {% if lastModified %}<meta property="article:modified_time" content="{{ lastModified | htmlDateString }}">{% endif %}
    {% for tag in tags %}<meta property="article:tag" content="{{ tag }}">{% endfor %}

    {# Twitter Card Meta Tags #}
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ title or metadata.title }}">
    <meta name="twitter:description" content="{{ description or metadata.description }}">
    {# Construct the full URL to the Twitter image using the |url filter for the path #}
    <meta name="twitter:image" content="{{ metadata.url }}{{ ('/og/' + og_image_slug + '.png') | url }}">

    <meta name="description" content="{{ description or metadata.description }}">
{% endblock %}

{# This is the main content block for the post #}
{% block content %}
<article class="post">
    <h1>{{ title }}</h1>
    <p class="post-meta">
        Publicat el {# User-facing "Published on" remains Catalan #}
        <time datetime="{{ date | htmlDateString }}">{{ date | readableDate }}</time>
        {% if tags and tags.length %}
            | Etiquetes: {# User-facing "Tags:" remains Catalan #}
            {% for tag in tags %}
                {# Construct tag link using the |url filter #}
                <a href="{{ ('/tags/' + (tag | slugify) + '/') | url }}" class="tag">{{ tag }}</a>{% if not loop.last %}, {% endif %}
            {% endfor %}
        {% endif %}
    </p>

    {{ content | safe }}

    {# This is a good place to optionally add the AdSense ad unit if desired within each post #}
    {# {% include "partials/adsense-unit.njk" %} #}
</article>
{% endblock %}
